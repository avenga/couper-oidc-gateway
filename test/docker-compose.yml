version: '3'
services:
  couper-oidc-gateway:
    # build: ..
    image: avenga/couper:1.6.0
    volumes:
      - ../couper.hcl:/conf/couper.hcl
    ports:
    - 8080:8080
    depends_on:
      - test-openid-provider
    env_file:
      - test.env
    environment:
      - COUPER_WATCH=true
      - BACKEND_ORIGIN=https://couper.io
      - BACKEND_HOSTNAME=couper.io
      - OIDC_CONFIGURATION_URL=http://testop:8080/.well-known/openid-configuration
      - OIDC_CLIENT_ID=foo
      - OIDC_CLIENT_SECRET=bar
  test-openid-provider:
    image: avenga/couper:edge
    hostname: testop
    volumes:
      - ./openid-provider:/conf
    ports:
    - 8081:8080
    environment:
      - COUPER_WATCH=true

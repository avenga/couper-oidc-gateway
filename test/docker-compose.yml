version: '3'
services:
  couper-oidc-gateway:
    # build: ..
    image: avenga/couper:edge
    volumes:
      - ../couper.hcl:/conf/couper.hcl
    ports:
    - 8080:8080
    depends_on:
      - test-openid-provider
    env_file:
      - test.env
    environment:
      - COUPER_WATCH=true
      - ORIGIN=https://couper.io
      - ORIGIN_HOSTNAME=couper.io
  test-openid-provider:
    image: avenga/couper:edge
    volumes:
      - ./openid-provider/couper.hcl:/conf/couper.hcl
      - ./openid-provider/htdocs:/conf/htdocs
    ports:
    - 8081:8080
    environment:
      - COUPER_WATCH=true
